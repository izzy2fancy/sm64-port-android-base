name: Build SM64 Windows Android APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4.1.1
      with:
        submodules: 'recursive'
      
    - name: Install Java JDK
      uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '17'
      
    - name: Install Android SDK/NDK
      uses: android-actions/setup-android@v2
      with:
        components: 'build-tools;28.0.3,platform-tools,tools'
        ndk-version: '21.0.6113669'
      
    - name: Copy baserom
      run: |
       cp baserom.us.z64 ./app/jni/src/baserom.us.z64
      
    - name: Get SDL sources
      run: ./getSDL.sh
      
    - name: Perform native build
      run: |
        cd sm64-port-android-base/app/jni/src
        make --jobs 4
        make --jobs 4
        cd ../../..
      
    - name: Perform Android build
      run: gradlew.bat assembleDebug
